<!DOCTYPE html>
<html lang="zh-Hant-TW">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ELK Stack 整合 pfSense (二)：Elasticsearch | Oscar&#39;s Pathways</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/logo.png">
    <link rel="apple-touch-icon" href="/logo.png">
    <link rel="mask-icon" href="/logo.svg" color="#333333">
    <link rel="alternate" type="application/rss+xml" href="http://lytzeng.github.io/rss.xml" title="Oscar&#39;s Pathways RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="http://lytzeng.github.io/feed.atom" title="Oscar&#39;s Pathways Atom Feed">
    <link rel="alternate" type="application/json" href="http://lytzeng.github.io/feed.json" title="Oscar&#39;s Pathways JSON Feed"><link rel='canonical' href='http://lytzeng.github.io/posts/infra/elasticsearch-receives-data-from-logstash.html'/>
    <meta name="description" content="本系列文章介紹 pfSense 與 ELK Stack (7.6 版) 的整合，藉此分析與收集阻擋的連接紀錄。Elasticsearch 是個全文搜尋引擎，透過 Inverted Index 的資料結構來提供即時的搜尋和分析功能。整個 ELK Stack 讀取和分析的 Log 就是儲存在 Elasticsearch，因此 Elasticsearch 需要足夠的儲存空間，而且它專門接收 JSON 型態的資料，所以除了和 Logstash 整合，只要能輸出 JSON 格式的工具都能與 Elasticsearch 整合。">
    <meta name="image" content="http://lytzeng.github.io/images/infra/elasticsearch-receives-data-from-logstash.png">
    <meta name="twitter:title" content="ELK Stack 整合 pfSense (二)：Elasticsearch">
    <meta name="twitter:description" content="本系列文章介紹 pfSense 與 ELK Stack (7.6 版) 的整合，藉此分析與收集阻擋的連接紀錄。Elasticsearch 是個全文搜尋引擎，透過 Inverted Index 的資料結構來提供即時的搜尋和分析功能。整個 ELK Stack 讀取和分析的 Log 就是儲存在 Elasticsearch，因此 Elasticsearch 需要足夠的儲存空間，而且它專門接收 JSON 型態的資料，所以除了和 Logstash 整合，只要能輸出 JSON 格式的工具都能與 Elasticsearch 整合。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://lytzeng.github.io/images/infra/elasticsearch-receives-data-from-logstash.png">
    <meta name="twitter:url" content="http://lytzeng.github.io/posts/infra/elasticsearch-receives-data-from-logstash.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ELK Stack 整合 pfSense (二)：Elasticsearch">
    <meta property="og:description" content="本系列文章介紹 pfSense 與 ELK Stack (7.6 版) 的整合，藉此分析與收集阻擋的連接紀錄。Elasticsearch 是個全文搜尋引擎，透過 Inverted Index 的資料結構來提供即時的搜尋和分析功能。整個 ELK Stack 讀取和分析的 Log 就是儲存在 Elasticsearch，因此 Elasticsearch 需要足夠的儲存空間，而且它專門接收 JSON 型態的資料，所以除了和 Logstash 整合，只要能輸出 JSON 格式的工具都能與 Elasticsearch 整合。">
    <meta property="og:image" content="http://lytzeng.github.io/images/infra/elasticsearch-receives-data-from-logstash.png">
    <meta property="og:url" content="http://lytzeng.github.io/posts/infra/elasticsearch-receives-data-from-logstash.html">
    <meta property="article:tag" content="ELK">
    <meta itemprop="name" content="ELK Stack 整合 pfSense (二)：Elasticsearch">
    <meta itemprop="description" content="本系列文章介紹 pfSense 與 ELK Stack (7.6 版) 的整合，藉此分析與收集阻擋的連接紀錄。Elasticsearch 是個全文搜尋引擎，透過 Inverted Index 的資料結構來提供即時的搜尋和分析功能。整個 ELK Stack 讀取和分析的 Log 就是儲存在 Elasticsearch，因此 Elasticsearch 需要足夠的儲存空間，而且它專門接收 JSON 型態的資料，所以除了和 Logstash 整合，只要能輸出 JSON 格式的工具都能與 Elasticsearch 整合。">
    <meta itemprop="image" content="http://lytzeng.github.io/images/infra/elasticsearch-receives-data-from-logstash.png">
    <meta name="theme-color" content="#333333">
    <meta prefix="og: http://ogp.me/ns#" property="og:article:author" content="Li-Yen Tseng">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#333333">
    <meta name="google-site-verification" content="luVocIl3165-z3eRtc2ux4f0_QqyqMiauRI-fD0GoJ0">
    <link rel="preload" href="/assets/css/0.styles.58b086f6.css" as="style"><link rel="preload" href="/assets/js/app.a0b10a22.js" as="script"><link rel="preload" href="/assets/js/2.4abc6c77.js" as="script"><link rel="preload" href="/assets/js/3.24286270.js" as="script"><link rel="preload" href="/assets/js/13.d37c2d82.js" as="script"><link rel="prefetch" href="/assets/js/10.0fe316ce.js"><link rel="prefetch" href="/assets/js/11.c2f0e8df.js"><link rel="prefetch" href="/assets/js/12.7d2f5e95.js"><link rel="prefetch" href="/assets/js/14.fdb85dfc.js"><link rel="prefetch" href="/assets/js/15.74b02e26.js"><link rel="prefetch" href="/assets/js/16.5d3a301d.js"><link rel="prefetch" href="/assets/js/17.5591eb7b.js"><link rel="prefetch" href="/assets/js/18.fff40bd9.js"><link rel="prefetch" href="/assets/js/19.7a1b3939.js"><link rel="prefetch" href="/assets/js/20.5b429bc6.js"><link rel="prefetch" href="/assets/js/21.1ddd6459.js"><link rel="prefetch" href="/assets/js/22.938ad97b.js"><link rel="prefetch" href="/assets/js/23.74617305.js"><link rel="prefetch" href="/assets/js/24.6abd4844.js"><link rel="prefetch" href="/assets/js/25.60e33ca5.js"><link rel="prefetch" href="/assets/js/26.e0c91c2e.js"><link rel="prefetch" href="/assets/js/27.74e19b9e.js"><link rel="prefetch" href="/assets/js/28.99756806.js"><link rel="prefetch" href="/assets/js/29.64a9a864.js"><link rel="prefetch" href="/assets/js/30.072288c8.js"><link rel="prefetch" href="/assets/js/31.5e1fee3b.js"><link rel="prefetch" href="/assets/js/32.48dcf787.js"><link rel="prefetch" href="/assets/js/33.ba19ce5b.js"><link rel="prefetch" href="/assets/js/34.25b08d25.js"><link rel="prefetch" href="/assets/js/35.02d2dca8.js"><link rel="prefetch" href="/assets/js/36.b1971acd.js"><link rel="prefetch" href="/assets/js/37.9b066a16.js"><link rel="prefetch" href="/assets/js/38.a006327f.js"><link rel="prefetch" href="/assets/js/4.7e77c6cc.js"><link rel="prefetch" href="/assets/js/5.fdc84017.js"><link rel="prefetch" href="/assets/js/6.8d73f1bb.js"><link rel="prefetch" href="/assets/js/7.8e216ccf.js"><link rel="prefetch" href="/assets/js/8.c634d950.js"><link rel="prefetch" href="/assets/js/9.bd212c42.js">
    <link rel="stylesheet" href="/assets/css/0.styles.58b086f6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Oscar's Pathways" class="logo"> <span class="site-name can-hide">Oscar's Pathways</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/categories/" class="nav-link">Categories</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div class="bio bio-sidebar"><div class="img-holder"><img src="/bio.jpg"></div> <p class="name">Oscar Tseng</p> <div style="border-bottom: 1px solid hsl(0, 0%, 30%); border-top: 1px solid hsl(0, 0%, 30%);"><div style="display: inline-block; padding: 0 10px; border-right: 1px solid hsl(0, 0%, 30%); margin: 5px 0"><a href="/categories/"><span style="display:block;font-family:'Noto Sans TC Medium';font-size:20px;">13</span> <span>Posts</span></a></div> <div style="display: inline-block; padding: 0 10px; margin: 5px 0"><a href="/tags/"><span style="display:block;font-family:'Noto Sans TC Medium';font-size:20px;">16</span> <span>Tags</span></a></div></div> <div style="display: flex; justify-content: center; padding-top: 5px; padding-bottom: 5px; border-bottom: 1px solid hsl(0, 0%, 30%);"><span style="width: 32px; height: 32px;"><a href="https://github.com/LYTzeng" target="_blank" rel="noopener" title="Github"><svg fill="#e6e6e6" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" style="will-change: transform;"><path fill-rule="evenodd" d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45 3 3 0 0 0 4.08 1.16 2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76 5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7 5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z"></path></svg></a></span> <span style="width: 32px; height: 32px;"><a href="https://www.linkedin.com/in/li-yen-tseng/" target="_blank" rel="noopener" title="Linkedin"><svg fill="#e6e6e6" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" style="will-change: transform;"><path d="M26.21 4H5.79A1.78 1.78 0 0 0 4 5.73V26.2a1.77 1.77 0 0 0 1.79 1.73h20.42A1.77 1.77 0 0 0 28 26.2V5.73A1.78 1.78 0 0 0 26.21 4zm-15.1 20.41H7.59V13h3.52zm-1.72-13a2.07 2.07 0 0 1-2.07-2.02 2 2 0 0 1 2.07-2.07 2.07 2.07 0 0 1 0 4.13zm15.09 12.93H21v-5.58c0-1.33 0-3.06-1.86-3.06S17 17.16 17 18.63v5.65h-3.56V13h3.32v1.5h.07a3.72 3.72 0 0 1 3.39-1.86c3.59 0 4.26 2.4 4.26 5.45z"></path></svg></a></span> <span style="width: 32px; height: 32px;"><a href="mailto:oscar217b@gmail.com" target="_blank" rel="noopener" title="mail"><svg fill="#e6e6e6" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" style="will-change: transform;"><path d="M28 6H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-2.2 2L16 14.78 6.2 8zM4 24V8.91l11.43 7.91a1 1 0 0 0 1.14 0L28 8.91V24z"></path><title>Email</title></svg></a></span> <span style="width: 32px; height: 32px;"><a href="/rss.xml" target="_blank" rel="noopener" title="rss" type="application/rss+xml"><svg fill="#e6e6e6" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true" style="will-change: transform;"><path d="M8 18c-3.3 0-6 2.7-6 6s2.7 6 6 6 6-2.7 6-6-2.7-6-6-6zm0 10c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm22-4h-2C28 13 19 4 8 4V2c12.1 0 22 9.9 22 22z"></path><path d="M22 24h-2c0-6.6-5.4-12-12-12v-2c7.7 0 14 6.3 14 14z"></path><title>Rss</title></svg></a></span> <span style="width: 32px; height: 32px;"><a href="https://netlab.csie.ntut.edu.tw" target="_blank" rel="noopener" title="NTUT CSIE Netlab" type="application/rss+xml"><img src="/Netlab-new-icon-darktheme.svg" style="width: 32px; height: 32px;"></a></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/categories/" class="nav-link">Categories</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ELK Stack 整合 pfSense (二)：Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/posts/infra/elasticsearch-receives-data-from-logstash.html#elk-stack-整合-pfsense-系列文" class="sidebar-link">ELK Stack 整合 pfSense 系列文</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/infra/elasticsearch-receives-data-from-logstash.html#安裝-elasticsearch" class="sidebar-link">安裝 Elasticsearch</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/posts/infra/elasticsearch-receives-data-from-logstash.html#references" class="sidebar-link">References</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> <div class="sidebar-links"><p class="sidebar-heading"><span>近期文章</span></p> <ul><li><a href="/posts/aws/lambda-apigateway-mattermost-go-ec2.html" class="sidebar-link recentTitle">透過 AWS Lambda、API Gateway 和 AWS Go SDK，從 Mattermost 查看/開關 EC2 Instances</a></li><li><a href="/posts/infra/monitoring-pfsense-via-kibana.html" class="sidebar-link recentTitle">ELK Stack 整合 pfSense (三)：Kibana Dashboard</a></li><li><a href="/posts/infra/elasticsearch-receives-data-from-logstash.html" class="sidebar-link recentTitle">ELK Stack 整合 pfSense (二)：Elasticsearch</a></li><li><a href="/posts/infra/sending-logs-from-pfsense-2-logstash.html" class="sidebar-link recentTitle">ELK Stack 整合 pfSense (一)：將 pfSense 防火牆阻擋紀錄傳送到 Logstash</a></li><li><a href="/posts/misc/Installing-macOS-on-ESXi.html" class="sidebar-link recentTitle">想擁有一台伺服器等級 Mac? macOS 10.15 Catalina on VMware ESXi 6.7</a></li></ul></div> <div class="sidebar-links"><p class="sidebar-heading"><span>Tags</span></p> <div class="tags sidebar-tags sidebar-link"><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/go"><div>go
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/aws lambda"><div>aws lambda
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/aws ec2"><div>aws ec2
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/aws api gateway"><div>aws api gateway
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/VuePress"><div>VuePress
        <div class="tagcount">3</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/ELK"><div>ELK
        <div class="tagcount">3</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/pfSense"><div>pfSense
        <div class="tagcount">4</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/VMware"><div>VMware
        <div class="tagcount">3</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/vSphere"><div>vSphere
        <div class="tagcount">3</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/OpenVPN"><div>OpenVPN
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/MacOS"><div>MacOS
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/心得想法"><div>心得想法
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/Mininet"><div>Mininet
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/OpenFlow"><div>OpenFlow
        <div class="tagcount">2</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/Ryu"><div>Ryu
        <div class="tagcount">1</div></div></a></span></span><span><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1><a href="/tags/Python"><div>Python
        <div class="tagcount">1</div></div></a></span></span></div></div> </aside> <main class="page"> <div class="theme-default-content content__default"><p><img alt="" data-src="/images/infra/elasticsearch-receives-data-from-logstash.png" loading="lazy" class="lazy"></p> <h1 id="elk-stack-整合-pfsense-二-：elasticsearch"><a href="#elk-stack-整合-pfsense-二-：elasticsearch" class="header-anchor">#</a> ELK Stack 整合 pfSense (二)：Elasticsearch</h1> <div class="page-edit"><div title="最後更新" class="timestamp"><span class="prefix"><svg fill="#ececec" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 32" aria-hidden="true" style="display: inline-block; vertical-align: middle; will-change: transform;"><path d="M2 27H30V29H2zM25.41 9a2 2 0 0 0 0-2.83L21.83 2.59a2 2 0 0 0-2.83 0l-15 15V24h6.41zm-5-5L24 7.59l-3 3L17.41 7zM6 22V18.41l10-10L19.59 12l-10 10z"></path><title>Calendar</title></svg></span> <span class="time">3/16/2020, 6:58:24 AM</span></div> <div title="建立時間" class="timestamp"><span class="prefix"><svg fill="#ececec" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 32" aria-hidden="true" style="display: inline-block; vertical-align: middle; will-change: transform;"><path d="M26 4.03h-4v-2h-2v2h-8v-2h-2v2H6a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h20a2 2 0 0 0 2-2v-20a2 2 0 0 0-2-2zm0 22H6v-14h20zm0-16H6v-4h4v2h2v-2h8v2h2v-2h4z"></path><title>Calendar</title></svg></span> <span class="time">3/13/2020, 9:55:28 AM</span></div></div> <div><div class="taglinks"><a href="/categories/#Infra"><div style="display:inline;"><svg fill="#14cdef" focusable="false" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 32 32" aria-hidden="true" style="display:inline-block;vertical-align:middle;will-change:transform;"><path d="M11.17 6l3.42 3.41.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z"></path><title>Folder</title></svg></div>
  Infra</a> <a href="/tags/ELK"><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1>ELK</span></a><a href="/tags/pfSense"><span class="badge tip" style="vertical-align:center;" data-v-0f5ba3f1>pfSense</span></a></div></div> <p>本系列文章介紹 pfSense 與 ELK Stack (7.6 版) 的整合，藉此分析與收集阻擋的連接紀錄。Elasticsearch 是個<a href="https://zh.wikipedia.org/wiki/%E5%85%A8%E6%96%87%E6%AA%A2%E7%B4%A2" target="_blank" rel="noopener noreferrer">全文搜尋引擎<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，透過 <a href="https://en.wikipedia.org/wiki/Inverted_index" target="_blank" rel="noopener noreferrer">Inverted Index<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的資料結構來提供即時的搜尋和分析功能。整個 ELK Stack 讀取和分析的 Log 就是儲存在 Elasticsearch，因此 Elasticsearch 需要足夠的儲存空間，而且它專門接收 JSON 型態的資料，所以除了和 Logstash 整合，只要能輸出 JSON 格式的工具都能與 Elasticsearch 整合。在查詢時皆透過 REST API，文件中有提到可使用 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-uri-request.html" target="_blank" rel="noopener noreferrer">Query String<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或是 Query DSL <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html" target="_blank" rel="noopener noreferrer">在 GET 的 request body 塞 JSON 查詢指令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，雖然目前沒有定義 GET method 的 body 的用途，關於是否可以這樣使用也存在不少爭議，不過看起來 Elastic 他們就自行使用了。</p> <p>整個 pfSense 與 ELK Stack 的架構如下面這張圖，架設過程中只要注意一下 Port 的對應其他都沒有太大的問題。</p> <p><img alt="" data-src="https://i.imgur.com/yMAxVaB.png" loading="lazy" class="lazy"></p> <h2 id="elk-stack-整合-pfsense-系列文"><a href="#elk-stack-整合-pfsense-系列文" class="header-anchor">#</a> ELK Stack 整合 pfSense 系列文</h2> <ul><li><a href="/posts/infra/sending-logs-from-pfsense-2-logstash.html">ELK Stack 整合 pfSense (一)：將 pfSense 防火牆阻擋紀錄傳送到 Logstash</a></li> <li>[本篇] ELK Stack 整合 pfSense (二)：Elasticsearch</li> <li><a href="/posts/infra/monitoring-pfsense-via-kibana.html">ELK Stack 整合 pfSense (三)：Kibana Dashboard</a></li></ul> <h2 id="安裝-elasticsearch"><a href="#安裝-elasticsearch" class="header-anchor">#</a> 安裝 Elasticsearch</h2> <p>依照<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html#deb-repo" target="_blank" rel="noopener noreferrer">文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>步驟安裝，一樣要先裝 Java，再裝 Elasticsearch。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> default-jre -y
<span class="token function">wget</span> -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-https
<span class="token builtin class-name">echo</span> <span class="token string">&quot;deb https://artifacts.elastic.co/packages/7.x/apt stable main&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/apt/sources.list.d/elastic-7.x.list
<span class="token function">sudo</span> <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y elasticsearch
</code></pre></div><p>Elasticsearch 的設定檔放在<code>/etc/elasticsearch/elasticsearch.yml</code>，<code>elasticsearch.yml</code>有幾個地方需要特別注意。</p> <h4 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="header-anchor">#</a> <code>elasticsearch.yml</code></h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># 因為我另外掛載大容量的 NFS 來當作儲存空間，所以需要修改預設的路徑。</span>
<span class="token comment"># 儲存 data 的地放</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /boot/lib/elasticsearch
<span class="token comment"># 儲存 log 的地方</span>
<span class="token key atrule">path.log</span><span class="token punctuation">:</span> /boot/log/elasticserch

<span class="token comment"># 如果 Kibana 和 Elasticsearch 不在同一台，一定要修改 IP。</span>
<span class="token comment"># 預設是 Listen 127.0.0.1 的，不修改的話無法讓其他主機連接</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 172.30.0.5
<span class="token comment"># 由於 network.host 非 loopback address</span>
<span class="token comment"># Elasticsearch 會認為這是 Production 環境</span>
<span class="token comment"># 所以必須修改 discovery.seed_hosts</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;172.30.0.5&quot;</span><span class="token punctuation">]</span>
</code></pre></div><p>接著就可以啟動 Elasticsearch，Elasticsearch 會透過 <mark>Port 9200</mark> 接收 Logstash 的資料和接收查詢指令，然後透過 <mark>Port 9300</mark> 和 Kibana 進行 Keepalive。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start elasticsearch.service
</code></pre></div><p>然後檢查 Port 狀態：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">netstat</span> -nlt
</code></pre></div><p>注意 9200 與 9300：</p> <div class="language- extra-class"><pre class="language-text"><code>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp6       0      0 172.30.0.5:9200         :::*                    LISTEN
tcp6       0      0 172.30.0.5:9300         :::*                    LISTEN
tcp6       0      0 :::22                   :::*                    LISTEN
</code></pre></div><p>如果 Logstash 已經在運作，我們會看得到 Elasticsearch 和 Logstash 建立的 connection：</p> <div class="language- extra-class"><pre class="language-text"><code>root@elasticsearch:/etc/elasticsearch# netstat -net | grep 9200
tcp6       0      0 172.30.0.5:9200         172.30.0.4:51242        ESTABLISHED 111        253749
</code></pre></div><p>接著等待 Logstash 傳送一些資料之後，可以透過 API 查詢看看是否收到資料。之前在 Logstash 的 output config 有定義 <strong>index</strong> 名稱為 <code>logstash-pfSense-%{+YYYY.MM.dd}</code>，所以查詢所有資料可以在 URL 用<code>logstash-pfSense-\*</code>，<code>_search</code>就是查詢所有資料，<code>?pretty=true</code>是為了讓輸出結果方便人類閱讀。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> http://172.30.0.5:9200/logstash-pfSense-<span class="token punctuation">\</span>*/_search<span class="token punctuation">\</span>?pretty<span class="token operator">=</span>true
</code></pre></div><p>如果有看到一堆 JSON 格式的資料，就代表成功了，這邊沒有要特別研究查詢語法，因為接下來的工作就是讓 Kibana 查詢並製作視覺化 Dashboard。</p> <p><img alt="" data-src="https://i.imgur.com/Mj39JDh.png" loading="lazy" class="lazy"></p> <h2 id="references"><a href="#references" class="header-anchor">#</a> References</h2> <ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/deb.html" target="_blank" rel="noopener noreferrer">Install Elasticsearch with Debian Package | Elasticsearch Reference [7.6] | Elastic<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-uri-request.html" target="_blank" rel="noopener noreferrer">URI Search | Elasticsearch Reference [7.6] | Elastic<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div id="disqus_thread"></div></div> <!----> </main> <footer><div>
      Copyright © 2019-present Li Yen Tseng, Powered by <a href="http://vuepress.vuejs.org">VuePress</a></div></footer></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.a0b10a22.js" defer></script><script src="/assets/js/2.4abc6c77.js" defer></script><script src="/assets/js/3.24286270.js" defer></script><script src="/assets/js/13.d37c2d82.js" defer></script>
  </body>
</html>
